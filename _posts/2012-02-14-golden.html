---
layout: d3
title: The Golden Gate
---

<div class="one columns">
	<h2>{{ page.title }}</h2>
	<p>
		I'm really excited about this post.  It combines several things I enjoy: outdoor activities, data visualization, Ruby, and Javascript.
	</p>
	<p>
		This weekend I ran in the Golden Gate Trail Run half marathon.  It was the longest distance I have ever ran and it was nothing short of amazing.
	</p>
	<p>
		The results are posted online, but are a little hard to consume.  So, I scrubbed the page with a fast little Ruby parser called Nokogiri, saved the results as XML, and used XSLT to display as HTML under the "Raw" tab.
	</p>
	
	<ul class="tabs">
	  <!-- Give href an ID value of corresponding "tabs-content" <li>'s -->
	  <li><a class="active" href="#pace">By Pace</a></li>
	  <li><a href="#raw">Raw</a></li>
	</ul>

	<!-- Standard <ul> with class of "tabs-content" -->
	<ul class="tabs-content">
	  <!-- Give ID that matches HREF of above anchors -->
	  <li class="active" id="pace">
			<div class="charts"></div>
	  </li>
	  <li id="raw">
			<script type="text/javascript">
				var xmlhttp;
				if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
			  	xmlhttp=new XMLHttpRequest();
			  }
				else {// code for IE6, IE5
			  	xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
			  }
			  xmlhttp.open("GET","/data/GoldenGate2012Results.xml",false);
				xmlhttp.send();
				xmlDoc=xmlhttp.responseXML; 
				document.write("<table class='grid'>");
				var x = xmlDoc.getElementsByTagName("runner");
				var data = new Array();
				document.write("<thead><tr><th>Place</th><th>Gender</th><th>Age</th><th>Hometown</th><th>Time</th><th>Pace</th></tr></thead>");
				for (i=0;i<x.length;i++) {
					if (x[i].getElementsByTagName("name")[0].childNodes[0].nodeValue == "Elizabeth Greer")
					{
						document.write("<tr class='highlight'>");
					}
					else {
						document.write("<tr>");
					}
					// Place is an attribute on runner
				  document.write("<td>" + x[i].attributes.getNamedItem("place").value + "</td>");
				  // Gender is an attribute on runner
				  document.write("<td>" + x[i].attributes.getNamedItem("gender").value + "</td>");
				  // Age is an attribute on runner
				  document.write("<td>" + x[i].attributes.getNamedItem("age").value + "</td>");
				  // City
				  document.write("<td>" + x[i].getElementsByTagName("city")[0].childNodes[0].nodeValue + "</td>");
				  // Time
				  document.write("<td>" + x[i].getElementsByTagName("time")[0].childNodes[0].nodeValue + "</td>");
				  // Pace
				  var pace = x[i].getElementsByTagName("pace")[0].childNodes[0].nodeValue;
				  data.push(pace.replace("/M","").replace(":","."));
				  document.write("<td>" + pace + "</td>");
				  
				  document.write("</tr>");
				}
				document.write("</table>");
			</script>
		</li>
	</ul>
</div>
<div class="one columns golden">
</div>

<script type="text/javascript">
	
	var w = 4,
      h = 20;
  
	var x = d3.scale.linear()
     .domain([0, 1])
     .range([0, w]);
     
  var y = d3.scale.linear()
     .domain([0, 20])
     .rangeRound([0, h]); //rangeRound is used for antialiasing
     
	var chart = d3.select(".charts").append("svg")
     .attr("class", "chart")
     .attr("width", w * data.length)
     .attr("height", h);
  
  // width is the width of the bar
  // height is the height of the bar
  // x and y are the position of the bar
  // for crips edges use -.5 (antialiasing)
  chart.selectAll("rect")
     .data(data)
   .enter().append("rect")
   		.attr("x", function(d, i) { return x(i) - .5; })
   		.attr("y", function(d) { return h - y(d) - .5; })
     	.attr("width", w)
     	.attr("height", function(d) { return y(d); } );

	chart.append("line")
     .attr("x1", 0)
     .attr("x2", w * data.length)
     .attr("y1", h - .5)
     .attr("y2", h - .5)
     .style("stroke", "#000");

</script>